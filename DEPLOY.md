# ربط المشروع ببيئة LibyanSpider (النشر)

## 1. تجهيز المشروع للنشر

- المشروع جاهز: يستخدم `process.env.PORT` و `process.env.SESSION_SECRET`.
- في الإنتاج يُفضّل تعيين **SESSION_SECRET** من لوحة تحكم البيئة (متغيرات البيئة) وعدم تركه افتراضي.

---

## 2. رفع الكود للبيئة

### الطريقة أ: عبر Git (مستحسنة)

1. **إنشاء مستودع Git** (مثلاً على GitHub أو GitLab):
   - لا ترفع مجلد `node_modules` ولا ملف `data/shop.db` (موجودان في `.gitignore`).

2. **في لوحة LibyanSpider:**
   - ادخل إلى بيئتك (مثل env-6069530).
   - افتح **Deployments** (النشر).
   - اختر **ربط مستودع Git** أو **Deploy from repository**.
   - أدخل رابط المستودع وفرع النشر (مثلاً `main`).
   - احفظ الإعدادات.

3. **أمر البناء والتشغيل (إن طُلب منك):**
   - Build: `npm install`
   - Start: `npm start` أو `node server.js`

4. **المسار (إن طُلب):**  
   اترك الجذر (root) إذا المشروع في جذر المستودع.

### الطريقة ب: رفع أرشيف (إن وُجدت)

- إذا كانت لوحة LibyanSpider تدعم رفع ملفات أو أرشيف:
  - ارفع محتويات مجلد المشروع (بدون `node_modules` وبدون `data/shop.db`).
  - تأكد أن الملفات في **جذر التطبيق** الذي تحدده البيئة لـ Node.js.

---

## 3. متغيرات البيئة على LibyanSpider

في إعدادات البيئة أو الـ Application Server، عيّن إن وُجدت:

| المتغير | الوصف | مثال |
|--------|--------|------|
| `NODE_ENV` | بيئة التشغيل | `production` |
| `PORT` | منفذ التطبيق (غالباً تحدده المنصة تلقائياً) | لا تحتاج تعيينه عادة |
| `SESSION_SECRET` | سري الجلسات (مهم للأمان) | سلسلة عشوائية طويلة |

---

## 4. التخزين وقاعدة البيانات

- المشروع يستخدم **SQLite** (ملف `data/shop.db`).
- إذا كان قرص السيرفر **مؤقتاً** (يُمسح عند إعادة التشغيل):
  - إما ربط **Storage Container** أو تخزين دائم من LibyanSpider بمجلد التطبيق (أو بمجلد فرعي مثل `data`) حتى لا يُحذف `shop.db`.
- إذا وُجدت **MariaDB** في نفس البيئة وترغب بالانتقال لها لاحقاً، يمكن تعديل المشروع لاستخدام MySQL/MariaDB بدلاً من SQLite.

---

## 5. بعد النشر

- عنوان لوحة التحكم سيكون تقريباً:
  - `https://env-6069530.tip2.libyanspider.cloud/admin/login`
  (أو الدومين الذي تربطه LibyanSpider لبيئتك).
- غيّر كلمة مرور الأدمن الافتراضية (`admin` / `admin123`) فوراً بعد أول دخول.

---

## 6. إذا ظهر 502 Bad Gateway أو الموقع "مفاش يفتح"

- **تأكد من أمر التشغيل:** في إعدادات الـ Application Server أو Build يجب أن يكون:
  - **Start / Run command:** `npm start` أو `node server.js`
- **المنفذ:** المنصة عادة تحدد `PORT` تلقائياً؛ لا تغيّر شيء إلا إذا طُلِب منك.
- **سجلات التشغيل (Logs):** من لوحة LibyanSpider ادخل إلى **Logs** أو **Console** لخادم Node.js وابحث عن:
  - `الخادم يعمل على المنفذ` = التطبيق شغال.
  - أي رسالة خطأ (مثلاً عن sql.js أو مسار ملف) = انسخها وراجع الإعدادات أو المسارات.
- **فحص بسيط:** بعد النشر جرّب فتح:  
  `https://env-6069530.tip2.libyanspider.cloud/health`  
  إذا ظهرت كلمة `ok` فالتطبيق يعمل والمشكلة قد تكون من إعدادات الـ Load Balancer أو المسار.

---

## 7. ملخص سريع

1. ارفع الكود عبر **Git** (أو أرشيف) إلى البيئة.
2. تأكد أن أمر التشغيل هو **`npm start`**.
3. عيّن **SESSION_SECRET** و **NODE_ENV=production** في متغيرات البيئة.
4. تأكد أن مجلد **data** (أو مسار ملف SQLite) على تخزين دائم إن أمكن.
5. ادخل إلى `/admin/login` وغيّر كلمة المرور.
