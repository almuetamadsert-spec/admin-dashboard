# تجربة محلية — خطوة بخطوة

اتبع بالترتيب. إذا فشل شيء، توقف عند الخطوة التي فيها الخطأ.

---

## الخطوة 1: تشغيل السيرفر (Node)

1. افتح **PowerShell** أو **CMD**.
2. اذهب لمجلد المشروع:
   ```bash
   cd C:\Users\Prof\Desktop\nodjs
   ```
3. شغّل السيرفر:
   ```bash
   node server.js
   ```
4. يجب أن تظهر رسالة مثل: `الخادم يعمل على المنفذ 3000`.
5. **اترك هذه النافذة مفتوحة** ولا تغلقها. اللوحة الطرفية هذه تكون مشغولة بالسيرفر ولا تقبل أوامر جديدة — لأي أمر آخر (مثل تشغيل التطبيق) افتح **طرفية جديدة**.

---

## الخطوة 2: التأكد أن السيرفر يرد

1. افتح **متصفح Chrome** على الكمبيوتر.
2. في شريط العنوان اكتب:
   ```
   http://localhost:3000/health
   ```
3. اضغط Enter.
4. يجب أن تظهر كلمة **ok** فقط في الصفحة.
   - إذا ظهرت **ok** → السيرفر يعمل، انتقل للخطوة 3.
   - إذا لم تفتح الصفحة أو ظهر خطأ → ارجع للخطوة 1 وتأكد أن `node server.js` يعمل ولا توجد رسالة خطأ.

---

## الخطوة 3: التحقق من المفتاح والمدن (مرة واحدة)

1. في المتصفح اذهب إلى:
   ```
   http://localhost:3000/admin/login
   ```
2. سجّل الدخول (مثلاً admin / admin123).
3. من القائمة: **الإعدادات** → قسم **مفاتيح API**.
4. إن لم يكن لديك مفتاح:
   - املأ "اسم المفتاح" (مثل: تطبيق) واختر "قراءة وكتابة" واضغط **إنشاء المفتاح**.
   - انسخ **Consumer Key** و **Consumer Secret** فوراً (السر لا يظهر مرة أخرى).
5. افتح الملف **`store_app\lib\config.dart`** في المحرر.
6. الصق المفتاح في `consumerKey` والسر في `consumerSecret` (بين علامتي الاقتباس، بدون مسافة قبل ck_ أو cs_).
7. احفظ الملف (Ctrl+S).

8. **إضافة مدن للتوصيل (مهم للطلب):** من لوحة التحكم → **مدن التوصيل** → أضف مدينة (مثل: طرابلس، بنغازي) مع رسوم التوصيل. بدون مدن لن تظهر قائمة المدن في التطبيق ولن تتمكن من إرسال الطلب.

---

## الخطوة 4: تشغيل التطبيق على الويب (أسهل تجربة محلية)

1. افتح **PowerShell (أو CMD) جديد** في نافذة/تبويب ثانٍ — لأن الطرفية التي تشغّل السيرفر لا تقبل أوامر جديدة.
2. اذهب لمجلد التطبيق:
   ```bash
   cd C:\Users\Prof\Desktop\nodjs\store_app
   ```
3. نفّذ:
   ```bash
   flutter pub get
   flutter run -d chrome
   ```
   (إن لم يتوفر Chrome يختار Flutter متصفحاً آخر، أو استخدم `flutter run -d web-server` ثم افتح الرابط الذي يظهر.)
4. عندما يفتح المتصفح:
   - التطبيق يستخدم تلقائياً **localhost:3000** على الويب.
   - يجب أن تظهر قائمة **المنتجات** إذا كان السيرفر يعمل والمفتاح صحيح.
5. إذا ظهر خطأ "Failed to fetch":
   - تأكد أن الخطوة 1 و 2 تمتا (السيرفر يعمل و /health يعيد ok).
   - تأكد أن في `config.dart` قيمة `baseUrlOverride` هي `null` (للويب لا تحتاج تغييرها).
6. إذا ظهر خطأ بالمفتاح (401 أو "غير صحيح"):
   - تأكد من الخطوة 3 (نسخ المفتاح والسر من اللوحة بدون مسافة زائدة).

---

## الخطوة 5 (اختياري): تجربة من الطرفية بدون Flutter

لتأكد أن الـ API يعمل من نفس الجهاز بدون متصفح ولا Flutter:

1. في **PowerShell** (من مجلد `nodjs`):
   ```bash
   node test-api.js
   ```
2. إن كان المفتاح في ملف `test-api-keys.json` صحيحاً، ستظهر رسالة مثل:
   - ✓ السيرفر يعمل
   - ✓ المنتجات: X منتج
   - ✓ المدن: X مدينة

إذا نجح هذا وفشل Flutter، المشكلة من إعداد Flutter أو المنصة. إذا فشل هذا أيضاً، المشكلة من السيرفر أو المفتاح.

---

## ملخص سريع

| ماذا تريد           | ماذا تفعل |
|---------------------|-----------|
| تجربة من المتصفح    | السيرفر يعمل → `flutter run -d chrome` من مجلد store_app. لا تحتاج تغيير baseUrl على الويب. |
| تجربة من محاكي أندرويد | نفس الأمر، لكن اختر جهاز Android عند `flutter run`. التطبيق يستخدم 10.0.2.2 تلقائياً. |
| تجربة من هاتف حقيقي | الهاتف والكمبيوتر على نفس الـ Wi‑Fi، في config.dart ضع `baseUrlOverride = 'http://IP_الكمبيوتر:3000'`. |

---

## أخطاء شائعة

- **"Failed to fetch"** → السيرفر غير مشغّل أو الجدار الناري يمنع المنفذ 3000. تحقق من الخطوة 1 و 2.
- **"المفتاح أو السر غير صحيح"** → أعد نسخ المفتاح والسر من اللوحة إلى config.dart (بدون مسافة أو تاب قبل ck_).
- **قائمة المدينة فارغة** → من لوحة التحكم اذهب إلى **مدن التوصيل** وأضف مدينة واحدة على الأقل (الاسم ورسوم التوصيل). ثم في التطبيق اضغط "إعادة تحميل" بجانب حقل المدينة.
- **المنتجات لا تظهر** → من لوحة التحكم → المنتجات → أضف منتجاً واحداً على الأقل.
