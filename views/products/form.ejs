<%- include('../partials/head', { title: product ? 'تعديل منتج' : 'منتج جديد' }) %>
<%- include('../partials/sidebar', { adminUsername }) %>

<h4 class="mb-4"><%= product ? 'تعديل المنتج' : 'إضافة منتج جديد' %></h4>
<form method="post" action="<%= product ? '/admin/products/edit/' + product.id : '/admin/products' %>" enctype="multipart/form-data" class="card p-4">
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">الاسم (عربي) *</label>
      <input type="text" name="name_ar" class="form-control" value="<%= product ? product.name_ar : '' %>" required>
    </div>
    <div class="col-md-6 mb-3">
      <label class="form-label">الاسم (إنجليزي)</label>
      <input type="text" name="name_en" class="form-control" value="<%= product ? product.name_en : '' %>">
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">الوصف القصير</label>
    <textarea name="short_description" class="form-control" rows="2"><%= product ? product.short_description : '' %></textarea>
  </div>
  <div class="mb-3">
    <label class="form-label">الوصف الطويل</label>
    <textarea name="long_description" class="form-control" rows="4"><%= product ? product.long_description : '' %></textarea>
  </div>
  <div class="row">
    <div class="col-md-4 mb-3">
      <label class="form-label">السعر (د.ل) *</label>
      <input type="number" step="0.01" name="price" class="form-control" value="<%= product ? product.price : '' %>" required>
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">نسبة التخفيض %</label>
      <input type="number" step="0.01" name="discount_percent" class="form-control" value="<%= product ? product.discount_percent : 0 %>">
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">الشركة</label>
      <input type="text" name="company" class="form-control" value="<%= product ? product.company : '' %>">
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">التصنيف</label>
      <select name="category_id" class="form-select">
        <option value="">— بدون تصنيف —</option>
        <% categories.forEach(function(c) { %>
        <option value="<%= c.id %>" <%= product && product.category_id == c.id ? 'selected' : '' %>><%= c.name_ar %></option>
        <% }); %>
      </select>
    </div>
    <div class="col-md-3 mb-3">
      <label class="form-label">الكمية في المخزون</label>
      <input type="number" name="stock" class="form-control" value="<%= product ? product.stock : 0 %>">
    </div>
    <div class="col-md-2 mb-3">
      <label class="form-label">حد التنبيه عند النفاد</label>
      <input type="number" name="low_stock_alert" class="form-control" value="<%= product ? (product.low_stock_alert || 0) : 0 %>" placeholder="0 = لا تنبيه">
    </div>
    <div class="col-md-2 mb-3">
      <label class="form-label">إخفاء عند نفاد الكمية</label>
      <select name="hide_when_out_of_stock" class="form-select">
        <option value="0" <%= product && !product.hide_when_out_of_stock ? 'selected' : '' %>>لا</option>
        <option value="1" <%= product && product.hide_when_out_of_stock ? 'selected' : '' %>>نعم</option>
      </select>
    </div>
    <div class="col-md-2 mb-3">
      <label class="form-label">الحالة</label>
      <select name="is_active" class="form-select">
        <option value="1" <%= product && product.is_active != 0 ? 'selected' : '' %>>نشط</option>
        <option value="0" <%= product && product.is_active == 0 ? 'selected' : '' %>>معطل</option>
      </select>
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label">صورة رئيسية</label>
    <input type="file" name="image" class="form-control" accept="image/*">
    <% if (product && product.image_path) { %>
      <small class="text-muted">الصورة الحالية: /uploads/<%= product.image_path %></small>
    <% } %>
  </div>
  <div class="mb-3">
    <label class="form-label">صور إضافية (متعددة)</label>
    <input type="file" name="images" class="form-control" accept="image/*" multiple>
  </div>
  <div class="d-flex gap-2">
    <button type="submit" class="btn btn-primary">حفظ</button>
    <a href="/admin/products" class="btn btn-outline-secondary">إلغاء</a>
  </div>
</form>

<%- include('../partials/scripts') %>
